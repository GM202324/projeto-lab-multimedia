<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra - Site Oficial</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Urbanist:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/style.css">

    <style>
        /* Ajustes específicos de layout para o checkout */
        h1 { margin-top: 40px; margin-bottom: 30px; text-align: center; color: var(--highlight); font-family: var(--font-serif); }
        .container {
            max-width: 1000px; margin: 0 auto 50px auto; padding: 20px;
            display: grid; grid-template-columns: 1fr 1fr; gap: 50px; flex-grow: 1;
        }
        .order-summary { background: var(--card-block); padding: 40px; border-radius: 4px; height: fit-content; border: 1px solid var(--highlight); }
        .order-summary h3 { font-family: var(--font-serif); margin-bottom: 20px; color: var(--text-light); border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
        .product-details { margin-bottom: 20px; font-size: 1.2rem; }
        .product-name { font-weight: 700; color: var(--highlight); display: block; margin-bottom: 5px; font-size: 1.5rem; }
        .product-price { font-family: var(--font-sans); font-weight: 300; font-size: 1.3rem; }
        .checkout-form { display: flex; flex-direction: column; gap: 20px; }
        label { font-weight: 700; font-size: 0.9rem; text-transform: uppercase; margin-bottom: 5px; display: block; }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="header-logo"><img src="Logo/yellow.svg" alt="Logotipo"></a>
        </header>

    <h1>Finalizar Compra</h1>

    <div class="container">
        <div class="order-summary">
            <h3>Resumo do Pedido</h3>
            <div class="product-details">
                <span style="font-size: 0.9rem; opacity: 0.7;">Item selecionado:</span>
                <span id="display-name" class="product-name">Carregando...</span>
                <span id="display-price" class="product-price">...</span>
            </div>
            <p style="font-size: 0.9rem; margin-top: 20px; line-height: 1.5;">
                Você está a um passo de garantir o seu pedido. Preencha os dados ao lado para processar o pagamento e o envio.
            </p>
        </div>

        <form class="checkout-form" id="payment-form">
            <div>
                <label>Nome Completo</label>
                <input type="text" class="auth-input" placeholder="Seu nome" required>
            </div>
            <div>
                <label>Email</label>
                <input type="email" class="auth-input" placeholder="seu@email.com" required>
            </div>
            <div id="payment-div">
                <label>Método de Pagamento</label>
                <select class="auth-input" style="background: rgba(13,7,6,0.5);">
                    <option>MB Way</option>
                    <option>Cartão de Crédito</option>
                    <option>PayPal</option>
                </select>
            </div>
            
            <button type="submit" class="btn-main" id="submit-btn" style="width:100%">Confirmar Pagamento</button>
            <a href="index.html" class="back-link" style="text-align:center; display:block;">Cancelar e Voltar</a>
        </form>
    </div>

    <div id="custom-alert-overlay" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title" id="alert-title">Sucesso!</h3>
            <p class="modal-text" id="alert-message"></p>
            <button id="alert-close-btn" class="btn-main" style="min-width: auto;">Continuar</button>
        </div>
    </div>

    <script src="js/script.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const product = params.get('produto') || 'Item Desconhecido';
            const price = params.get('preco') || '0.00';

            document.getElementById('display-name').textContent = product;
            document.getElementById('display-price').textContent = price + ' €';

            if (price === '0.00') {
                document.getElementById('payment-div').style.display = 'none';
                document.getElementById('submit-btn').textContent = 'Confirmar Reserva';
            }
        });

        // Sobrescreve lógica do form para redirecionar no fim
        const form = document.getElementById('payment-form');
        const modal = document.getElementById('custom-alert-overlay'); // IDs do script.js
        const okBtn = document.getElementById('alert-close-btn'); 
        const msg = document.getElementById('alert-message');
        const title = document.getElementById('alert-title');

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const btnText = document.getElementById('submit-btn').textContent;
            
            title.textContent = "Confirmado";
            if (btnText === 'Confirmar Reserva') {
                msg.textContent = "Reserva confirmada! Os detalhes foram enviados para o seu email.";
            } else {
                msg.textContent = "Compra simulada com sucesso! Obrigado pela preferência.";
            }
            modal.classList.add('active');
            
            // Tracking da compra
            const product = document.getElementById('display-name').textContent;
            fetch('/api/track', {
                method: 'POST', headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: 'Compra Concluída', details: product })
            });
        });

        // Override do clique de fechar para redirecionar para a home
        okBtn.onclick = function() {
            window.location.href = 'index.html';
        };
    </script>

</body>
</html>